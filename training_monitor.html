<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emotion Detection Model - Training Monitor</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
            text-align: center;
        }

        .header h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .status-badge {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            margin-top: 10px;
            font-size: 0.9em;
        }

        .status-training {
            background: #ffd700;
            color: #333;
            animation: pulse 2s infinite;
        }

        .status-completed {
            background: #4caf50;
            color: white;
        }

        .status-error {
            background: #f44336;
            color: white;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .card h2 {
            color: #667eea;
            font-size: 1.3em;
            margin-bottom: 15px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .metric {
            margin: 15px 0;
        }

        .metric-label {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #333;
        }

        .metric-value.good {
            color: #4caf50;
        }

        .metric-value.warning {
            color: #ff9800;
        }

        .metric-value.bad {
            color: #f44336;
        }

        .progress-container {
            background: #f0f0f0;
            border-radius: 10px;
            height: 30px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-bar {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .chart-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .chart-container h2 {
            color: #667eea;
            font-size: 1.3em;
            margin-bottom: 20px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .info-item {
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .info-item strong {
            color: #667eea;
        }

        .refresh-info {
            text-align: center;
            color: white;
            margin-top: 20px;
            font-size: 0.9em;
        }

        .last-update {
            background: rgba(255,255,255,0.2);
            padding: 10px;
            border-radius: 8px;
            display: inline-block;
        }

        .model-download {
            background: #4caf50;
            color: white;
            padding: 15px 30px;
            border-radius: 8px;
            text-decoration: none;
            display: inline-block;
            margin-top: 15px;
            font-weight: bold;
            transition: background 0.3s;
        }

        .model-download:hover {
            background: #45a049;
        }

        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #c62828;
            margin: 20px 0;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: white;
            font-size: 1.2em;
        }

        .spinner {
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .emotion-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .emotion-tag {
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé≠ Emotion Detection Model Training</h1>
            <p>Real-time monitoring dashboard for CNN model training</p>
            <div id="statusBadge" class="status-badge status-training">Loading...</div>
        </div>

        <div id="loadingScreen" class="loading">
            <div class="spinner"></div>
            <p>Loading training data...</p>
        </div>

        <div id="mainContent" style="display: none;">
            <!-- Metrics Grid -->
            <div class="grid">
                <div class="card">
                    <h2>üìä Current Progress</h2>
                    <div class="metric">
                        <div class="metric-label">Epoch</div>
                        <div class="metric-value" id="currentEpoch">0 / 20</div>
                    </div>
                    <div class="progress-container">
                        <div class="progress-bar" id="progressBar" style="width: 0%">0%</div>
                    </div>
                </div>

                <div class="card">
                    <h2>‚úÖ Validation Accuracy</h2>
                    <div class="metric">
                        <div class="metric-label">Latest</div>
                        <div class="metric-value good" id="valAccuracy">0.00%</div>
                    </div>
                    <div class="metric-label" style="margin-top: 10px;">Training Accuracy</div>
                    <div style="font-size: 1.5em; font-weight: bold; color: #666;" id="trainAccuracy">0.00%</div>
                </div>

                <div class="card">
                    <h2>üìâ Loss Metrics</h2>
                    <div class="metric">
                        <div class="metric-label">Validation Loss</div>
                        <div class="metric-value" id="valLoss">0.0000</div>
                    </div>
                    <div class="metric-label" style="margin-top: 10px;">Training Loss</div>
                    <div style="font-size: 1.5em; font-weight: bold; color: #666;" id="trainLoss">0.0000</div>
                </div>

                <div class="card">
                    <h2>‚è±Ô∏è Time Estimates</h2>
                    <div class="metric">
                        <div class="metric-label">Elapsed Time</div>
                        <div class="metric-value" id="elapsedTime">0m 0s</div>
                    </div>
                    <div class="metric-label" style="margin-top: 10px;">Est. Remaining</div>
                    <div style="font-size: 1.5em; font-weight: bold; color: #666;" id="remainingTime">Calculating...</div>
                </div>
            </div>

            <!-- Charts -->
            <div class="chart-container">
                <h2>üìà Accuracy Trends</h2>
                <canvas id="accuracyChart"></canvas>
            </div>

            <div class="chart-container">
                <h2>üìâ Loss Trends</h2>
                <canvas id="lossChart"></canvas>
            </div>

            <!-- Model Information -->
            <div class="card">
                <h2>ü§ñ Model Information</h2>
                <div class="info-grid">
                    <div class="info-item">
                        <strong>Total Parameters:</strong> <span id="totalParams">6,003,143</span>
                    </div>
                    <div class="info-item">
                        <strong>Model Size:</strong> <span id="modelSize">22.9 MB</span>
                    </div>
                    <div class="info-item">
                        <strong>Training Samples:</strong> <span id="trainSamples">5,236</span>
                    </div>
                    <div class="info-item">
                        <strong>Validation Samples:</strong> <span id="valSamples">1,311</span>
                    </div>
                    <div class="info-item">
                        <strong>Batch Size:</strong> <span id="batchSize">64</span>
                    </div>
                    <div class="info-item">
                        <strong>Image Size:</strong> <span id="imgSize">48x48</span>
                    </div>
                </div>
                <div style="margin-top: 15px;">
                    <strong style="color: #667eea;">Emotion Classes:</strong>
                    <div class="emotion-list" id="emotionList"></div>
                </div>
            </div>

            <!-- Final Results (shown when complete) -->
            <div id="finalResults" class="card" style="display: none; background: linear-gradient(135deg, #4caf50 0%, #45a049 100%); color: white;">
                <h2 style="color: white; border-bottom-color: white;">üéâ Training Complete!</h2>
                <div class="metric">
                    <div class="metric-label" style="color: rgba(255,255,255,0.9);">Final Validation Accuracy</div>
                    <div class="metric-value" style="color: white;" id="finalAccuracy">0.00%</div>
                </div>
                <a href="face_emotionModel.h5" download class="model-download">üì• Download Trained Model</a>
                <a href="index.html" class="model-download" style="background: #667eea; margin-left: 10px;">üß™ Test Model</a>
            </div>
        </div>

        <div class="refresh-info">
            <div class="last-update">
                Last updated: <span id="lastUpdate">Never</span> | Auto-refresh every 30 seconds
            </div>
        </div>
    </div>

    <script>
        let accuracyChart, lossChart;
        let refreshInterval;

        // Initialize charts
        function initCharts() {
            const chartConfig = {
                type: 'line',
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            };

            // Accuracy Chart
            accuracyChart = new Chart(document.getElementById('accuracyChart'), {
                ...chartConfig,
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Training Accuracy',
                            data: [],
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'Validation Accuracy',
                            data: [],
                            borderColor: '#4caf50',
                            backgroundColor: 'rgba(76, 175, 80, 0.1)',
                            tension: 0.4
                        }
                    ]
                }
            });

            // Loss Chart
            lossChart = new Chart(document.getElementById('lossChart'), {
                ...chartConfig,
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Training Loss',
                            data: [],
                            borderColor: '#ff9800',
                            backgroundColor: 'rgba(255, 152, 0, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'Validation Loss',
                            data: [],
                            borderColor: '#f44336',
                            backgroundColor: 'rgba(244, 67, 54, 0.1)',
                            tension: 0.4
                        }
                    ]
                }
            });
        }

        // Format time in seconds to readable format
        function formatTime(seconds) {
            if (!seconds || seconds < 0) return 'Calculating...';
            
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            
            if (hours > 0) {
                return `${hours}h ${minutes}m ${secs}s`;
            } else if (minutes > 0) {
                return `${minutes}m ${secs}s`;
            } else {
                return `${secs}s`;
            }
        }

        // Update dashboard with training data
        function updateDashboard(data) {
            // Update status badge
            const statusBadge = document.getElementById('statusBadge');
            if (data.status === 'training') {
                statusBadge.textContent = 'üîÑ Training in Progress';
                statusBadge.className = 'status-badge status-training';
            } else if (data.status === 'completed') {
                statusBadge.textContent = '‚úÖ Training Completed';
                statusBadge.className = 'status-badge status-completed';
                document.getElementById('finalResults').style.display = 'block';
            }

            // Update progress
            const progress = (data.epochs_completed / data.total_epochs) * 100;
            document.getElementById('currentEpoch').textContent = `${data.epochs_completed} / ${data.total_epochs}`;
            document.getElementById('progressBar').style.width = `${progress}%`;
            document.getElementById('progressBar').textContent = `${progress.toFixed(1)}%`;

            // Update latest metrics
            if (data.latest_metrics) {
                const valAcc = (data.latest_metrics.val_accuracy * 100).toFixed(2);
                const trainAcc = (data.latest_metrics.accuracy * 100).toFixed(2);
                
                document.getElementById('valAccuracy').textContent = `${valAcc}%`;
                document.getElementById('trainAccuracy').textContent = `${trainAcc}%`;
                document.getElementById('valLoss').textContent = data.latest_metrics.val_loss.toFixed(4);
                document.getElementById('trainLoss').textContent = data.latest_metrics.loss.toFixed(4);

                // Color code accuracy
                const valAccElem = document.getElementById('valAccuracy');
                if (valAcc >= 60) valAccElem.className = 'metric-value good';
                else if (valAcc >= 40) valAccElem.className = 'metric-value warning';
                else valAccElem.className = 'metric-value bad';

                if (data.status === 'completed') {
                    document.getElementById('finalAccuracy').textContent = `${valAcc}%`;
                }
            }

            // Update time estimates
            document.getElementById('elapsedTime').textContent = formatTime(data.elapsed_time);
            document.getElementById('remainingTime').textContent = formatTime(data.estimated_time_remaining);

            // Update model info
            if (data.model_info) {
                document.getElementById('totalParams').textContent = data.model_info.total_params.toLocaleString();
                document.getElementById('modelSize').textContent = `${data.model_info.model_size_mb} MB`;
                document.getElementById('trainSamples').textContent = data.model_info.train_samples.toLocaleString();
                document.getElementById('valSamples').textContent = data.model_info.val_samples.toLocaleString();
                document.getElementById('batchSize').textContent = data.model_info.batch_size;
                document.getElementById('imgSize').textContent = `${data.model_info.img_size}x${data.model_info.img_size}`;

                // Update emotion list
                const emotionList = document.getElementById('emotionList');
                emotionList.innerHTML = data.model_info.emotions.map(e => 
                    `<span class="emotion-tag">${e}</span>`
                ).join('');
            }

            // Update charts
            if (data.history && data.history.epoch.length > 0) {
                accuracyChart.data.labels = data.history.epoch;
                accuracyChart.data.datasets[0].data = data.history.accuracy.map(v => v * 100);
                accuracyChart.data.datasets[1].data = data.history.val_accuracy.map(v => v * 100);
                accuracyChart.update();

                lossChart.data.labels = data.history.epoch;
                lossChart.data.datasets[0].data = data.history.loss;
                lossChart.data.datasets[1].data = data.history.val_loss;
                lossChart.update();
            }

            // Update last update time
            document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString();

            // Hide loading, show content
            document.getElementById('loadingScreen').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
        }

        // Fetch training progress
        async function fetchProgress() {
            try {
                const response = await fetch('training_progress.json?t=' + Date.now());
                if (response.ok) {
                    const data = await response.json();
                    updateDashboard(data);
                    
                    // Stop auto-refresh if training is complete
                    if (data.status === 'completed' && refreshInterval) {
                        clearInterval(refreshInterval);
                    }
                } else {
                    throw new Error('Failed to fetch progress data');
                }
            } catch (error) {
                console.error('Error fetching progress:', error);
                document.getElementById('loadingScreen').innerHTML = `
                    <div class="error-message">
                        <strong>‚ö†Ô∏è Unable to load training data</strong><br>
                        Make sure training_progress.json exists and the training script is running.
                    </div>
                `;
            }
        }

        // Initialize
        window.addEventListener('load', () => {
            initCharts();
            fetchProgress();
            
            // Auto-refresh every 30 seconds
            refreshInterval = setInterval(fetchProgress, 30000);
        });
    </script>
</body>
</html>

